{% extends "tasks/base.html" %}

{% block title %}Settings â€” TaskVO{% endblock %}

{% block content %}
<main class="flex-1 p-4 sm:p-8 overflow-auto">
    <h2 class="text-4xl font-orbitron font-bold text-blue-400 mb-6 animate-fade-in-down text-center tracking-tight">Settings</h2>

    <div class="flex flex-col bg-gray-800 rounded-2xl shadow-xl border border-blue-700 w-full max-w-3xl mx-auto space-y-6 p-6 sm:p-8">
        <!-- Profile Management -->
        <section class="space-y-4">
            <h3 class="text-2xl font-orbitron font-semibold text-blue-400 border-b border-blue-700 pb-2">Profile</h3>
            <form action="#" method="post" class="space-y-4">
                {% csrf_token %}
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="w-full sm:w-1/2">
                        <label for="name" class="block text-sm font-semibold text-gray-300 mb-1">Name</label>
                        <input type="text" id="name" name="name" value="{{ request.user.username }}" class="w-full p-3 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="email" class="block text-sm font-semibold text-gray-300 mb-1">Email</label>
                        <input type="email" id="email" name="email" value="{{ request.user.email }}" class="w-full p-3 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                </div>
                <button type="button" id="change-password-btn" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Change Password</button>
                <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Save Changes</button>
            </form>

            <!-- Change Password Modal -->
            <div id="password-modal" class="fixed inset-0 bg-transparent flex items-center justify-center hidden z-50" style="backdrop-filter: blur(5px);">
                <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-md shadow-xl border border-blue-700">
                    <h3 class="text-2xl font-orbitron font-semibold text-blue-400 mb-4">Change Password</h3>
                    <form id="password-form" class="space-y-4" method="post">
                        {% csrf_token %}
                        <div>
                            <label for="current-password" class="block text-sm font-semibold text-gray-300 mb-1">Current Password</label>
                            <input type="password" id="current-password" name="current-password" placeholder="Enter current password" class="w-full p-3 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="new-password" class="block text-sm font-semibold text-gray-300 mb-1">New Password</label>
                            <input type="password" id="new-password" name="new-password" placeholder="Enter new password" class="w-full p-3 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="confirm-password" class="block text-sm font-semibold text-gray-300 mb-1">Confirm New Password</label>
                            <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm new password" class="w-full p-3 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div class="flex justify-end gap-4">
                            <button type="button" id="cancel-password" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Cancel</button>
                            <button type="submit" id="save-password" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Notification Preferences -->
        <section class="space-y-4">
            <h3 class="text-2xl font-orbitron font-semibold text-blue-400 border-b border-blue-700 pb-2">Notifications</h3>
            <form class="space-y-3" method="post">
                {% csrf_token %}
                <div class="flex items-center gap-3">
                    <input type="checkbox" id="email-notif" name="type" value="email"
                        {% if request.user.profile.notif_type and 'email' in request.user.profile.notif_type.notif_type %}checked{% endif %}
                        class="rounded text-blue-600 focus:ring-blue-500" />
                    <label for="email-notif" class="text-sm font-medium text-gray-200">Email Notifications</label>
                </div>
                <div class="flex items-center gap-3">
                    <input type="checkbox" id="in-app-notif" name="type" value="app"
                        {% if request.user.profile.notif_type and 'app' in request.user.profile.notif_type.notif_type %}checked{% endif %}
                        class="rounded text-blue-600 focus:ring-blue-500" />
                    <label for="in-app-notif" class="text-sm font-medium text-gray-200">In-App Alerts</label>
                </div>
                <div class="flex items-center gap-3">
                    <label for="notif-frequency" class="text-sm font-medium text-gray-200">Frequency</label>
                    <select id="notif-frequency" name="notif-frequency" class="ml-2 p-2 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="daily" {% if request.user.profile.notif_frequency == 'daily' %} selected {% endif %}>Daily</option>
                        <option value="weekly" {% if request.user.profile.notif_frequency == 'weekly' %} selected {% endif %}>Weekly</option>
                        <option value="off" {% if request.user.profile.notif_frequency == 'off' %} selected {% endif %}>Off</option>
                    </select>
                </div>
                <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Update Notifications</button>
            </form>
        </section>

        <!-- Theme Settings -->
        <section class="space-y-4">
            <h3 class="text-2xl font-orbitron font-semibold text-blue-400 border-b border-blue-700 pb-2">Theme</h3>
            <div id="theme-controls" class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <input type="radio" id="dark-theme" name="theme" value="dark" checked class="rounded text-blue-600 focus:ring-blue-500" />
                    <label for="dark-theme" class="text-sm font-medium text-gray-200">Dark Mode</label>
                </div>
                <div class="flex items-center gap-2">
                    <input type="radio" id="light-theme" name="theme" value="light" class="rounded text-blue-600 focus:ring-blue-500" />
                    <label for="light-theme" class="text-sm font-medium text-gray-200">Light Mode</label>
                </div>
            </div>
        </section>

        <!-- Task Preferences -->
        <section class="space-y-4">
            <h3 class="text-2xl font-orbitron font-semibold text-blue-400 border-b border-blue-700 pb-2">Task Preferences</h3>
            <div class="space-y-3">
                <div>
                    <label for="default-due" class="block text-sm font-medium text-gray-200">Default Due Date</label>
                    <select id="default-due" name="default-due" class="w-full p-2 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="today">Today</option>
                        <option value="tomorrow">Tomorrow</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div>
                    <label for="default-category" class="block text-sm font-medium text-gray-200">Default Category</label>
                    <select id="default-category" name="default-category" class="w-full p-2 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All</option>
                        <option value="Work">Work</option>
                        <option value="Personal">Personal</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Save Preferences</button>
        </section>

        <!-- AI Settings -->
        <section class="space-y-4">
            <h3 class="text-2xl font-orbitron font-semibold text-blue-400 border-b border-blue-700 pb-2">AI Settings</h3>
            <div class="space-y-3">
                <div class="flex items-center gap-3">
                    <input type="checkbox" id="ai-assist" name="ai-assist" checked class="rounded text-blue-600 focus:ring-blue-500" />
                    <label for="ai-assist" class="text-sm font-medium text-gray-200">Enable AI Assistance</label>
                </div>
                <div class="flex items-center gap-3">
                    <label for="ai-verbosity" class="text-sm font-medium text-gray-200">Response Verbosity</label>
                    <select id="ai-verbosity" name="ai-verbosity" class="ml-2 p-2 rounded-lg bg-gray-900 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="brief">Brief</option>
                        <option value="detailed">Detailed</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200">Update AI Settings</button>
        </section>

        <!-- Account Deletion -->
        <section class="space-y-4">
            <h3 class="text-2xl font-orbitron font-semibold text-blue-400 border-b border-blue-700 pb-2">Account</h3>
            <p class="text-sm text-gray-400">Delete your account and all associated data. This action is irreversible.</p>
            <button type="button" class="w-full sm:w-auto px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold shadow-md transition-colors duration-200" onclick="if(confirm('Are you sure? This cannot be undone.')) { document.getElementById('delete-form').submit(); }">
                Delete Account
            </button>
            <form id="delete-form" action="/delete-account/" method="post" style="display: none;">
                {% csrf_token %}
            </form>
        </section>
    </div>
</main>


<script>
    const changePasswordBtn = document.getElementById('change-password-btn');
    const passwordModal = document.getElementById('password-modal');
    const cancelPasswordBtn = document.getElementById('cancel-password');
    const savePasswordBtn = document.getElementById('save-password');
    const passwordForm = document.getElementById('password-form');

    changePasswordBtn.addEventListener('click', () => {
        passwordModal.classList.remove('hidden');
        setTimeout(() => document.getElementById('current-password').focus(), 200);
    });

    cancelPasswordBtn.addEventListener('click', () => {
        passwordModal.classList.add('hidden');
        passwordForm.reset();
    });
</script>
{% endblock %}