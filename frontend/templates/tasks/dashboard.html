{% extends "tasks/base.html" %}
{% load static %}
<title>{% block title %} Dasboard &mdash; TaskVO {% endblock %} </title>

{% block content %}
    <!-- Main Content Area - Workspace Layout -->
    <main class="flex-1 p-4 sm:p-8 overflow-auto">
        <h2 class="text-4xl font-orbitron font-bold text-blue-400 mb-8 animate-fade-in-down">Dashboard Overview</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Welcome & Task Summary Card -->
            <div class="bg-gray-800 rounded-2xl shadow-xl border border-blue-700 p-6 flex flex-col justify-between animate-fade-in-down">
                <h3 class="text-3xl font-orbitron font-bold text-blue-400 mb-4">ðŸ‘‹ Welcome, {{ user.username }}!</h3>
                <p class="text-xl font-roboto text-gray-300">
                    {% if tasks_left_today > 0 %} 
                        <i class="fas fa-hourglass-half text-blue-400 mr-2"></i> 
                        You've got <span class="font-bold text-blue-300">{{ tasks_left_today }}</span> 
                        tasks left today! 
                    {% else %} 
                        <i class="fas fa-mug-hot text-blue-400 mr-2"></i> 
                        <span class="text-blue-300 font-bold">No tasks. Just vibes âœ¨</span>
                    {% endif %}
                </p>
                <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50">
                    <p>Last updated: June 19, 2025</p>
                </div>
            </div>

            <!-- Progress Bar Card -->
            <div class="bg-gray-800 rounded-2xl shadow-xl border border-blue-700 p-6 flex flex-col justify-between animate-fade-in-down" style="animation-delay: 0.1s;">
                <h3 class="text-2xl font-orbitron text-blue-400 mb-4">âœ… Task Progress</h3>
                <div class="w-full bg-gray-700 rounded-full h-4 mb-3 overflow-hidden shadow-inner">
                    <div class="bg-blue-500 h-4 rounded-full" style="width: {{ progress }}%;"></div>
                </div>
                <div class="text-center text-lg font-semibold text-gray-300">{{ today_completed_tasks }}/{{ todays_tasks }} tasks completed today!</div>
                <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50">
                    <p>Keep up the great work!</p>
                </div>
            </div>

            <!-- Goal of the Day Card -->
            <div class="bg-gray-800 rounded-2xl shadow-xl border border-blue-700 p-6 flex flex-col justify-between animate-fade-in-down" style="animation-delay: 0.2s;">
                <h3 class="text-2xl font-orbitron text-blue-400 mb-4">ðŸŽ¯ Goal of the day:</h3>
                <p id="daily-goal" class="text-lg font-roboto text-gray-200">Loading today's goal...</p>
                <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50">
                    <p>Stay focused!</p>
                </div>
            </div>

            <!-- Daily Motivation/Scripture Card -->
            <div class="bg-gray-800 rounded-2xl shadow-xl border border-blue-700 p-6 flex flex-col justify-between animate-fade-in-down" style="animation-delay: 0.3s;">
                <h3 class="text-2xl font-orbitron text-blue-400 mb-4">ðŸ§  Daily Motivation:</h3>
                <p class="text-lg font-roboto text-gray-200 italic">{{ daily_quote }}</p>
                <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50">
                    <p>Inspiration for your day.</p>
                </div>
            </div>

            <!-- Mini Chart Placeholder Card -->
            <div class="bg-gray-800 rounded-2xl shadow-xl border border-blue-700 p-6 flex flex-col justify-center items-center animate-fade-in-down" style="animation-delay: 0.4s;">
                <h3 class="text-2xl font-orbitron text-blue-400 mb-4">ðŸ“ˆ Task Completion Trends</h3>
                {% if current_plan == 'pro' %}
                    <div class="flex items-center justify-center h-24 w-full bg-gray-700 rounded-lg text-gray-400 text-lg">
                        <canvas id="taskTrendChart" class="w-full h-32"></canvas>
                    </div>
                    <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50 w-full text-center">
                        <p>Advanced reporting!</p>
                    </div>
                {% else %}
                    <div class="flex flex-col items-center justify-center h-full w-full py-8">
                        <p class="text-xl text-gray-400 mb-4 text-center">Unlock Advanced Reports!</p>
                        <a href="{% url 'core:payment_page' %}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300">
                            Upgrade to Pro
                        </a>
                    </div>
                    <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50 w-full text-center">
                        <p>Upgrade for insights into your productivity.</p>
                    </div>
                {% endif %}
            </div>

            <!-- Quick Actions/Recent Activity Placeholder Card -->
            <div class="bg-gray-800 rounded-2xl shadow-xl border border-blue-700 p-6 flex flex-col justify-between animate-fade-in-down" style="animation-delay: 0.5s;">
                <h3 class="text-2xl font-orbitron text-blue-400 mb-4">âš¡ Quick Actions</h3>
                <ul class="text-lg text-gray-200 space-y-2">
                    <li><a href="{% url 'core:tasks' %}" class="hover:text-blue-400 transition-colors"><i class="fas fa-plus-circle mr-2"></i> Add New Task</a></li>
                    <li><a href="{% url 'core:tasks' %}?filter=pending" class="hover:text-blue-400 transition-colors"><i class="fas fa-list-check mr-2"></i> View All Pending</a></li>
                </ul>
                <div class="mt-auto text-sm text-gray-500 pt-4 border-t border-gray-700/50">
                    <p>Access key features quickly.</p>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch("{% static 'json/goals.json' %}")
                .then(response => response.json())
                .then(goals => {
                    const randomGoal = goals[Math.floor(Math.random() * goals.length)];
                    const goalCard = document.querySelector('#daily-goal');
                    if (goalCard) {
                        goalCard.textContent = randomGoal.goal;
                    }
                })
                .catch(error => {
                    console.error("Couldnâ€™t fetch the daily goal ðŸ˜©:", error);
                });

            fetch('{% url "core:weekly_chart" %}')
                .then(res => res.json())
                .then(chart => {
                const ctx = document.getElementById('taskTrendChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chart.labels,
                        datasets: [{
                            label: 'Tasks Completed',
                            data: chart.data,
                            fill: false,
                            borderColor: '#3b82f6',
                            backgroundColor: '#60a5fa',
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#d1d5db'
                                },
                                grid: {
                                    color: '#374151'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#d1d5db'
                                },
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
                })
                .catch(error => {
                    console.error("Couldnâ€™t fetch the weekly chart data ðŸ˜©:", error);
                });
        });
    </script>
{% endblock %}